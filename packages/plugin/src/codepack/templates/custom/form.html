{% extends "demo/_layout" %}

{% set pageTitle = "Custom" %}
{% set page = "custom" %}

{% set formHandle = craft.app.request.segment(3) %}
{% set form = craft.freeform.form(formHandle) %}

{% set isSuccess  = craft.app.request.segment(4) == "success" %}

{% block content %}

    <div class="container">
        {% set formTemplate = form.settings.general.formattingTemplate %}

        {# Display a tip for demo templates #}
        <div class="alert alert-info" role="alert">
            <h5 class="alert-heading">For your information...</h5>
            <p class="mb-0">
                You currently have the <b><i>{{ formTemplate }}</i></b> formatting template assigned to this form. Within your regular site templates,
                be sure to specify any necessary CSS, JS and framework libraries to have the correct styles show up for the form.
            </p>

        {% if formTemplate == "foundation-6.twig" %}
            <hr>
            <p class="mb-0">
                We've detected you're using the <b>Foundation</b> sample formatting template and have automatically loaded the Foundation library inside this demo.
                The Bootstrap library is also loaded by default, so you may see some style conflicts in the demo area.
            </p>
        {% elseif ( formTemplate == "tailwind-1.twig" ) or ( formTemplate == "tailwind-3.twig" ) %}
            <hr>
            <p class="mb-0">
                We've detected you're using the <b>Tailwind</b> sample formatting template and have automatically loaded the Tailwind library inside this demo.
                The Bootstrap library is also loaded by default, so you may see some style conflicts in the demo area.
            </p>
        {% elseif ( formTemplate == "bootstrap-4/index.twig" ) or ( formTemplate == "bootstrap-5/index.twig" ) or ( formTemplate == "bootstrap-5-floating-labels/index.twig" ) or ( formTemplate == "bootstrap-5-dark/index.twig" ) or ( formTemplate == "bootstrap-5-multipage-all-fields/index.twig" ) %}
            <hr>
            <p class="mb-0">
                We've detected you're using the <b>Bootstrap</b> sample formatting template and have automatically loaded the Bootstrap library inside this demo.
            </p>
        {% endif %}
        </div>

        {# Display a tip for forms with submit limit setting enabled #}
        {% set limit = form.settings.behavior.limitSubmissions %}
        {% if limit %}
            <div class="alert alert-warning">
                <h5 class="alert-heading">Please note...</h5>
                <p class="mb-0">
                    You currently have a user submit limit setting enabled (<i>
                        {%- if limit == "auth_unlimited" -%}
                            Logged in Users only (no limit)
                        {%- elseif limit == "cookie" -%}
                            Once per Cookie
                        {%- elseif limit == "ip_cookie" -%}
                            Once per IP/Cookie combo
                        {%- elseif limit == "auth" -%}
                            Once per logged in Users
                        {%- elseif limit == "auth_cookie" -%}
                            Once per logged in User or Guest Cookie
                        {%- elseif limit == "auth_ip_cookie" -%}
                            Once per logged in User or Guest IP/Cookie combo
                        {%- else -%}
                            '{{ limit }}'
                        {%- endif -%}
                    </i>) for this form.
                </p>
            </div>
        {% endif %}

        {% set submissionLimitReached = form.submissionLimitReached %}

        {% if submissionLimitReached %}
            {# Maybe hide the form #}
        {% endif %}

        {# ... or show a message #}
        {% if submissionLimitReached %}
            <div class="alert alert-warning submission-limit-reached" role="alert">
                {{ "Submission Limit Reached" }}
            </div>
        {% endif %}

        {% if isSuccess %}
            <div class="alert alert-success" role="alert">
                {{ form.successMessage | t }}
            </div>
        {% endif %}

        {% if form %}

            <h3 class="mb-5">{{ form.name }}</h3>

            {{ form.render }}

        {% else %}
            <div class="alert alert-danger">
                Form with the handle '{{ formHandle }}' does not exist.
            </div>
        {% endif %}

    </div>

{% endblock %}

{% block headerCss %}
    {{ parent() }}
    {% if form %}
        {% set formTemplate = form.settings.general.formattingTemplate %}

        {% if formTemplate == "foundation-6.twig" %}
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.5.3/css/foundation.min.css">
            <style>
                [type=checkbox], [type=file], [type=radio] {
                    margin: 0;
                }
                ul.menu .is-active {
                    color: white;
                    background: grey;
                }
            </style>
        {% endif %}
        {% if ( formTemplate == "tailwind-1.twig" ) or ( formTemplate == "tailwind-3.twig" ) %}
            <link rel="stylesheet" href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css">
        {% endif %}
        {% if ( formTemplate == "bootstrap-3.twig" ) or ( formTemplate == "bootstrap-4.twig" ) %}
            <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
        {% endif %}
        {% if ( formTemplate == "bootstrap-5.twig" ) or ( formTemplate == "bootstrap-5-floating-labels/index.twig" ) or ( formTemplate == "bootstrap-5-dark/index.twig" ) or ( formTemplate == "bootstrap-5-multipage-all-fields/index.twig" ) %}
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        {% endif %}
    {% endif %}
{% endblock %}

{% block footerJs %}
    <script>
        const myForm = document.querySelector('form');

        // or freeform-ajax-after-submit or freeform-render-success
        myForm.addEventListener('freeform-ajax-success', function (event) {
            // Do something with event.response.submissionLimitReached
            // Hide the form or show a message
        });
    </script>

    {{ parent() }}
    {% if form %}
        {% set formTemplate = form.settings.general.formattingTemplate %}

        {% if formTemplate == "foundation-6.twig" %}
            <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.5.3/js/foundation.min.js"></script>
        {% endif %}

        {% if ( formTemplate == "bootstrap-3.twig" ) or ( formTemplate == "bootstrap-4.twig" ) %}
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
            <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
        {% endif %}

        {% if ( formTemplate == "bootstrap-5.twig" ) or ( formTemplate == "bootstrap-5-floating-labels/index.twig" ) or ( formTemplate == "bootstrap-5-dark/index.twig" or ( formTemplate == "bootstrap-5-multipage-all-fields/index.twig" ) ) %}
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
            <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
        {% endif %}
    {% endif %}
{% endblock %}

