{% extends "demo/_layout" %}

{% set pageTitle = "Checking Submission Duplicates | Extras" %}

{# Replace 'freeformSubmissionDuplicate' with your form handle #}
{% set demoFormHandle = "freeformSubmissionDuplicate" %}

{% block content %}

    {% set form = craft.freeform.form(demoFormHandle, { formattingTemplate: pageTemplateFile }) %}

    <div class="freeform-page-heading">
        <h2>Checking Submission Duplicates</h2>
        <p>This example shows how to check if the user has already submitted the form when using the <i>Limit Form Submission Rate</i> setting.</p>
    </div>

    {% set duplicateCheck = form.settings.duplicateCheck %}
    {% if form and duplicateCheck %}
        
        {# This optional conditional checks if the form has reached its submission limit set above #}
        {% if form.duplicate %}

            <div class="freeform-error">
                <h4>{{ "Already Submitted!" }}</h4>
                <p>
                    You have already submitted this form! No duplicates are allowed for this form.
                </p>
            </div>

        {% else %}

            {% if duplicateCheck %}
                <div class="freeform-notice">
                    {% if duplicateCheck == "no_limit" %}
                        {% set duplicateCheckType = false %}
                    {% elseif duplicateCheck == "no_limit_logged_in_users_only" %}
                        {% set duplicateCheckType = false %}
                    {% elseif duplicateCheck == "limit_once_per_logged_in_user_only" %}
                        {% set duplicateCheckType = "Logged in Users Only - Once per Form" %}
                    {% elseif duplicateCheck == "limit_once_per_email" %}
                        {% set duplicateCheckType = "Anyone - Once per Email Address" %}
                    {% elseif duplicateCheck == "limit_once_per_email" %}
                        {% set duplicateCheckType = "Anyone - Once per Email Address" %}
                    {% elseif duplicateCheck == "limit_once_per_user_or_cookie" %}
                        {% set duplicateCheckType = "Anyone - Once per Logged in User or Guest Cookie" %}
                    {% elseif duplicateCheck == "limit_once_per_user_or_ip_or_cookie" %}
                        {% set duplicateCheckType = "Anyone - Once per Logged in User or Guest IP/Cookie combo" %}
                    {% endif %}

                    {% if duplicateCheckType %}
                        <p>You currently have a user duplicate check submission settings enabled (<i>{{ duplicateCheckType }}</i>) for this form.</p>
                    {% endif %}
                </div>
            {% endif %}

            {{ form.render }}

        {% endif %}

    {% else %}

        <div class="freeform-error">
            <p>You must rename your form handle to <code>{{ demoFormHandle }}</code> and set a limit (<i>Limit Form Submission Rate</i> setting inside the <i>Validation</i> tab in the form builder) for this part of the demo to work.</p>
        </div>

    {% endif %}

    {# Instructions to get this page working correctly #}
    <div class="extras-instructions">
        <h4>This page will not display correctly until...</h4>
        <p>
            In order to view this page live, you'll need to make some adjustments to this template or your test form:
            <ol>
                <li>Rename your test form handle to <code>{{ demoFormHandle }}</code> or adjust the form handle name inside this template to match your test form.</li>
                <li>
                    Make sure you have the <b>Limit Form Submission Rate</b> setting enabled (inside the <i>Validation</i> tab in the form builder).
                </li>
                <li>This page template contains a conditional that will hide the form once it detects that the user has already submitted the form.</li>
            </ol>
        </p>
    </div>

{% endblock %}